\doxysection{lsha1.\+c File Reference}
\hypertarget{lsha1_8c}{}\label{lsha1_8c}\index{lsha1.c@{lsha1.c}}


SHA-\/1 implementation and Lua bindings.  


{\ttfamily \+\#include $<$stdio.\+h$>$}\newline
{\ttfamily \+\#include $<$string.\+h$>$}\newline
{\ttfamily \+\#include $<$stdint.\+h$>$}\newline
{\ttfamily \+\#include $<$lua.\+h$>$}\newline
{\ttfamily \+\#include $<$lauxlib.\+h$>$}\newline
{\ttfamily \+\#include $<$lcrypt.\+h$>$}\newline
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \doxymbox{\hyperlink{struct_s_h_a1___c_t_x}{SHA1\+\_\+\+CTX}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{lsha1_8c_a3ba9296b223f1b3c710d6b812fd860e8}\label{lsha1_8c_a3ba9296b223f1b3c710d6b812fd860e8} 
\+\#define {\bfseries SHA1\+\_\+\+DIGEST\+\_\+\+SIZE}~20
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_af1373930110e4f86cb1f4bc6d44a66ee}{rol}}(value,  bits)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_a1a75de24d0277c5319098c218efaef2d}{blk0}}(i)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_abd06ff24e9f6f5f0a9c32a1cba4b0f9c}{blk}}(i)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_a8ac24a09e1273548828d3cc9436f9bc7}{R0}}(v,  w,  x,  y,  z,  i)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_a2628f8af7bf67ca052200537279f855a}{R1}}(v,  w,  x,  y,  z,  i)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_a774229b80509be0e9e0a1d9819580224}{R2}}(v,  w,  x,  y,  z,  i)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_ac0b8b342432d17717ff1020d10cf0eea}{R3}}(v,  w,  x,  y,  z,  i)
\item 
\+\#define \doxymbox{\hyperlink{lsha1_8c_af77ddc8894422d2af2adbd4e71e55d1f}{R4}}(v,  w,  x,  y,  z,  i)
\item 
\Hypertarget{lsha1_8c_afcf795f5a96fd55561abe69f56224630}\label{lsha1_8c_afcf795f5a96fd55561abe69f56224630} 
\+\#define {\bfseries BLOCKSIZE}~64
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{lsha1_8c_aac84405dcaa75cec8b6f31b4dbaf127f}\label{lsha1_8c_aac84405dcaa75cec8b6f31b4dbaf127f} 
int {\bfseries lsha1} (\doxymbox{\hyperlink{structlua___state}{lua\+\_\+\+State}} \texorpdfstring{$\ast$}{*}L)
\item 
\Hypertarget{lsha1_8c_af6e94dedf557ce7d936989129fc6d66b}\label{lsha1_8c_af6e94dedf557ce7d936989129fc6d66b} 
int {\bfseries lhmac\+\_\+sha1} (\doxymbox{\hyperlink{structlua___state}{lua\+\_\+\+State}} \texorpdfstring{$\ast$}{*}L)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
SHA-\/1 implementation and Lua bindings. 

SHA-\/1 in C By Steve Reid \href{mailto:sreid@sea-to-sky.net}{\texttt{sreid@sea-\/to-\/sky.\+net}} 100\% Public Domain

\DoxyHorRuler{0}
 Modified 7/\+98 By James H. Brown \href{mailto:jbrown@burgoyne.com}{\texttt{jbrown@burgoyne.\+com}} Still 100\% Public Domain

Corrected a problem which generated improper hash values on 16 bit machines Routine SHA1\+Update changed from void SHA1\+Update(\+SHA1\+\_\+\+CTX\texorpdfstring{$\ast$}{*} context, unsigned char\texorpdfstring{$\ast$}{*} data, unsigned int len) to void SHA1\+Update(\+SHA1\+\_\+\+CTX\texorpdfstring{$\ast$}{*} context, unsigned char\texorpdfstring{$\ast$}{*} data, unsigned long len)

The \textquotesingle{}len\textquotesingle{} parameter was declared an int which works fine on 32 bit machines. However, on 16 bit machines an int is too small for the shifts being done against it. This caused the hash function to generate incorrect values if len was greater than 8191 (8K -\/ 1) due to the \textquotesingle{}len \texorpdfstring{$<$}{<}\texorpdfstring{$<$}{<} 3\textquotesingle{} on line 3 of SHA1\+Update().

Since the file IO in main() reads 16K at a time, any file 8K or larger would be guaranteed to generate the wrong hash (e.\+g. Test Vector \#3, a million "{}a"{}s).

I also changed the declaration of variables i \& j in SHA1\+Update to unsigned long from unsigned int for the same reason.

These changes should make no difference to any 32 bit implementations since an int and a long are the same size in those environments.

\DoxyHorRuler{0}
 I also corrected a few compiler warnings generated by Borland C.
\begin{DoxyEnumerate}
\item Added \+\#include \texorpdfstring{$<$}{<}process.\+h\texorpdfstring{$>$}{>} for exit() prototype
\item Removed unused variable \textquotesingle{}j\textquotesingle{} in SHA1\+Final
\item Changed exit(0) to return(0) at end of main.
\end{DoxyEnumerate}\hypertarget{lsha1_8c_autotoc_md38}{}\doxysubsubsection{\texorpdfstring{ALL changes I made can be located by searching for comments containing \textquotesingle{}JHB\textquotesingle{}}{ALL changes I made can be located by searching for comments containing \textquotesingle{}JHB\textquotesingle{}}}\label{lsha1_8c_autotoc_md38}
Modified 8/\+98 By Steve Reid \href{mailto:sreid@sea-to-sky.net}{\texttt{sreid@sea-\/to-\/sky.\+net}} Still 100\% public domain

1-\/ Removed \+\#include \texorpdfstring{$<$}{<}process.\+h\texorpdfstring{$>$}{>} and used return() instead of exit() 2-\/ Fixed overwriting of finalcount in SHA1\+Final() (discovered by Chris Hall) 3-\/ Changed email address from \href{mailto:steve@edmweb.com}{\texttt{steve@edmweb.\+com}} to \href{mailto:sreid@sea-to-sky.net}{\texttt{sreid@sea-\/to-\/sky.\+net}}

\DoxyHorRuler{0}
 Modified 4/\+01 By Saul Kravitz \href{mailto:Saul.Kravitz@celera.com}{\texttt{Saul.\+Kravitz@celera.\+com}} Still 100\% PD Modified to run on Compaq Alpha hardware.

\DoxyHorRuler{0}
 Modified 07/\+2002 By Ralph Giles \href{mailto:giles@ghostscript.com}{\texttt{giles@ghostscript.\+com}} Still 100\% public domain modified for use with stdint types, autoconf code cleanup, removed attribution comments switched SHA1\+Final() argument order for consistency use SHA1\+\_\+ prefix for public api move public api to sha1.\+h

\DoxyHorRuler{0}
 Modufiled 08/\+2014 By Cloud Wu \href{mailto:cloudwu@gmail.com}{\texttt{cloudwu@gmail.\+com}} Still 100\% PD Lua binding 

\label{doc-define-members}
\Hypertarget{lsha1_8c_doc-define-members}
\doxysubsection{Macro Definition Documentation}
\Hypertarget{lsha1_8c_abd06ff24e9f6f5f0a9c32a1cba4b0f9c}\index{lsha1.c@{lsha1.c}!blk@{blk}}
\index{blk@{blk}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{blk}{blk}}
{\footnotesize\ttfamily \label{lsha1_8c_abd06ff24e9f6f5f0a9c32a1cba4b0f9c} 
\+\#define blk(\begin{DoxyParamCaption}\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{(block.l[i\&15]\ =\ \ \ \ rol(block.l[(i+13)\&15]\string^block.l[(i+8)\&15]\ \(\backslash\)}
\DoxyCodeLine{\string^block.l[(i+2)\&15]\string^block.l[i\&15],1))}

\end{DoxyCode}
\Hypertarget{lsha1_8c_a1a75de24d0277c5319098c218efaef2d}\index{lsha1.c@{lsha1.c}!blk0@{blk0}}
\index{blk0@{blk0}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{blk0}{blk0}}
{\footnotesize\ttfamily \label{lsha1_8c_a1a75de24d0277c5319098c218efaef2d} 
\+\#define blk0(\begin{DoxyParamCaption}\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{(block.l[i]\ =\ (rol(block.l[i],24)\&0xFF00FF00)\ \(\backslash\)}
\DoxyCodeLine{|(rol(block.l[i],8)\&0x00FF00FF))}

\end{DoxyCode}
\Hypertarget{lsha1_8c_a8ac24a09e1273548828d3cc9436f9bc7}\index{lsha1.c@{lsha1.c}!R0@{R0}}
\index{R0@{R0}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{R0}{R0}}
{\footnotesize\ttfamily \label{lsha1_8c_a8ac24a09e1273548828d3cc9436f9bc7} 
\+\#define R0(\begin{DoxyParamCaption}\item[{}]{v}{, }\item[{}]{w}{, }\item[{}]{x}{, }\item[{}]{y}{, }\item[{}]{z}{, }\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{z+=((w\&(x\string^y))\string^y)+blk0(i)+0x5A827999+rol(v,5);w=rol(w,30);}

\end{DoxyCode}
\Hypertarget{lsha1_8c_a2628f8af7bf67ca052200537279f855a}\index{lsha1.c@{lsha1.c}!R1@{R1}}
\index{R1@{R1}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{R1}{R1}}
{\footnotesize\ttfamily \label{lsha1_8c_a2628f8af7bf67ca052200537279f855a} 
\+\#define R1(\begin{DoxyParamCaption}\item[{}]{v}{, }\item[{}]{w}{, }\item[{}]{x}{, }\item[{}]{y}{, }\item[{}]{z}{, }\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{z+=((w\&(x\string^y))\string^y)+blk(i)+0x5A827999+rol(v,5);w=rol(w,30);}

\end{DoxyCode}
\Hypertarget{lsha1_8c_a774229b80509be0e9e0a1d9819580224}\index{lsha1.c@{lsha1.c}!R2@{R2}}
\index{R2@{R2}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{R2}{R2}}
{\footnotesize\ttfamily \label{lsha1_8c_a774229b80509be0e9e0a1d9819580224} 
\+\#define R2(\begin{DoxyParamCaption}\item[{}]{v}{, }\item[{}]{w}{, }\item[{}]{x}{, }\item[{}]{y}{, }\item[{}]{z}{, }\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{z+=(w\string^x\string^y)+blk(i)+0x6ED9EBA1+rol(v,5);w=rol(w,30);}

\end{DoxyCode}
\Hypertarget{lsha1_8c_ac0b8b342432d17717ff1020d10cf0eea}\index{lsha1.c@{lsha1.c}!R3@{R3}}
\index{R3@{R3}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{R3}{R3}}
{\footnotesize\ttfamily \label{lsha1_8c_ac0b8b342432d17717ff1020d10cf0eea} 
\+\#define R3(\begin{DoxyParamCaption}\item[{}]{v}{, }\item[{}]{w}{, }\item[{}]{x}{, }\item[{}]{y}{, }\item[{}]{z}{, }\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{z+=(((w|x)\&y)|(w\&x))+blk(i)+0x8F1BBCDC+rol(v,5);w=rol(w,30);}

\end{DoxyCode}
\Hypertarget{lsha1_8c_af77ddc8894422d2af2adbd4e71e55d1f}\index{lsha1.c@{lsha1.c}!R4@{R4}}
\index{R4@{R4}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{R4}{R4}}
{\footnotesize\ttfamily \label{lsha1_8c_af77ddc8894422d2af2adbd4e71e55d1f} 
\+\#define R4(\begin{DoxyParamCaption}\item[{}]{v}{, }\item[{}]{w}{, }\item[{}]{x}{, }\item[{}]{y}{, }\item[{}]{z}{, }\item[{}]{i}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{z+=(w\string^x\string^y)+blk(i)+0xCA62C1D6+rol(v,5);w=rol(w,30);}

\end{DoxyCode}
\Hypertarget{lsha1_8c_af1373930110e4f86cb1f4bc6d44a66ee}\index{lsha1.c@{lsha1.c}!rol@{rol}}
\index{rol@{rol}!lsha1.c@{lsha1.c}}
\doxysubsubsection{\texorpdfstring{rol}{rol}}
{\footnotesize\ttfamily \label{lsha1_8c_af1373930110e4f86cb1f4bc6d44a66ee} 
\+\#define rol(\begin{DoxyParamCaption}\item[{}]{value}{, }\item[{}]{bits}{}\end{DoxyParamCaption})}

{\bfseries Value:\+}
\begin{DoxyCode}{0}
\DoxyCodeLine{(((value)\ <<\ (bits))\ |\ \ ((value)\ >>\ (32\ -\/\ (bits))))}

\end{DoxyCode}
