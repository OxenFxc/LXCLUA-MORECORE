\doxysection{lopcodes.\+h}
\hypertarget{lopcodes_8h_source}{}\label{lopcodes_8h_source}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{**\ \$Id:\ lopcodes.h\ \$}}
\DoxyCodeLine{00003\ \textcolor{comment}{**\ Opcodes\ for\ Lua\ virtual\ machine}}
\DoxyCodeLine{00004\ \textcolor{comment}{**\ See\ Copyright\ Notice\ in\ lua.h}}
\DoxyCodeLine{00005\ \textcolor{comment}{*/}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#ifndef\ lopcodes\_h}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ lopcodes\_h}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}llimits.h"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{comment}{/*================================================================}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ We\ assume\ that\ instructions\ are\ unsigned\ 64-\/bit\ integers.}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ \ All\ instructions\ have\ an\ opcode\ in\ the\ first\ 9\ bits.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ \ Instructions\ can\ have\ the\ following\ formats:}}
\DoxyCodeLine{00017\ \textcolor{comment}{}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ \ \ \ \ \ \ \ 6\ 6\ 6\ 6\ 6\ 6\ 6\ 6\ 6\ 6\ 5\ 5\ 5\ 5\ 5\ 5\ 5\ 5\ 5\ 5\ 4\ 4\ 4\ 4\ 4\ 4\ 4\ 4\ 4\ 4\ 3\ 3\ 3\ 3\ 3\ 3\ 3\ 3\ 3\ 3\ 2\ 2\ 2\ 2\ 2\ 2\ 2\ 2\ 2\ 2\ 1\ 1\ 1\ 1\ 1\ 1\ 1\ 1\ 1\ 1\ 0\ 0\ 0\ 0\ 0\ 0\ 0\ 0\ 0\ 0}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ \ \ \ \ \ \ \ 3\ 2\ 1\ 0\ 9\ 8\ 7\ 6\ 5\ 4\ 3\ 2\ 1\ 0\ 9\ 8\ 7\ 6\ 5\ 4\ 3\ 2\ 1\ 0\ 9\ 8\ 7\ 6\ 5\ 4\ 3\ 2\ 1\ 0\ 9\ 8\ 7\ 6\ 5\ 4\ 3\ 2\ 1\ 0\ 9\ 8\ 7\ 6\ 5\ 4\ 3\ 2\ 1\ 0\ 9\ 8\ 7\ 6\ 5\ 4\ 3\ 2\ 1\ 0}}
\DoxyCodeLine{00020\ \textcolor{comment}{iABC\ \ \ \ \ \ \ \ \ \ C(16)\ \ \ \ \ |\ \ \ \ \ \ B(16)\ \ \ \ |k|\ \ \ \ \ A(16)\ \ \ \ \ \ |\ \ \ Op(9)\ \ \ \ \ |}}
\DoxyCodeLine{00021\ \textcolor{comment}{ivABC\ \ \ \ \ \ \ \ \ vC(20)\ \ \ \ \ |\ \ \ \ \ vB(14)\ \ \ |k|\ \ \ \ \ A(16)\ \ \ \ \ \ |\ \ \ Op(9)\ \ \ \ \ |}}
\DoxyCodeLine{00022\ \textcolor{comment}{iABx\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Bx(33)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ A(16)\ \ \ \ \ \ |\ \ \ Op(9)\ \ \ \ \ |}}
\DoxyCodeLine{00023\ \textcolor{comment}{iAsBx\ \ \ \ \ \ \ \ \ \ \ \ \ \ sBx\ (signed)(33)\ \ \ \ \ \ |\ \ \ \ \ A(16)\ \ \ \ \ \ |\ \ \ Op(9)\ \ \ \ \ |}}
\DoxyCodeLine{00024\ \textcolor{comment}{iAx\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Ax(49)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ Op(9)\ \ \ \ \ |}}
\DoxyCodeLine{00025\ \textcolor{comment}{isJ\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sJ\ (signed)(49)\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ Op(9)\ \ \ \ \ |}}
\DoxyCodeLine{00026\ \textcolor{comment}{}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ \ ('v'\ stands\ for\ "{}variant"{},\ 's'\ for\ "{}signed"{},\ 'x'\ for\ "{}extended."{})}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ \ A\ signed\ argument\ is\ represented\ in\ excess\ K:\ The\ represented\ value\ is}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ \ the\ written\ unsigned\ value\ minus\ K,\ where\ K\ is\ half\ (rounded\ down)\ the}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ \ maximum\ value\ for\ the\ corresponding\ unsigned\ argument.}}
\DoxyCodeLine{00031\ \textcolor{comment}{================================================================*/}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{comment}{/*\ basic\ instruction\ formats\ */}}
\DoxyCodeLine{00035\ \textcolor{keyword}{enum}\ OpMode\ \{iABC,\ ivABC,\ iABx,\ iAsBx,\ iAx,\ isJ\};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{comment}{/*}}
\DoxyCodeLine{00039\ \textcolor{comment}{**\ size\ and\ position\ of\ opcode\ arguments.}}
\DoxyCodeLine{00040\ \textcolor{comment}{*/}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#define\ SIZE\_C\ \ \ \ \ \ 16}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#define\ SIZE\_vC\ \ \ \ \ 20}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#define\ SIZE\_B\ \ \ \ \ \ 16}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#define\ SIZE\_vB\ \ \ \ \ 14}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#define\ SIZE\_Bx\ \ \ \ \ (SIZE\_C\ +\ SIZE\_B\ +\ 1)}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#define\ SIZE\_A\ \ \ \ \ \ 16}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#define\ SIZE\_Ax\ \ \ \ \ (SIZE\_Bx\ +\ SIZE\_A)}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#define\ SIZE\_sJ\ \ \ \ \ (SIZE\_Bx\ +\ SIZE\_A)}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#define\ SIZE\_OP\ \ \ \ \ 9}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#define\ POS\_OP\ \ \ \ \ \ 0}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#define\ POS\_A\ \ \ \ \ \ \ (POS\_OP\ +\ SIZE\_OP)}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#define\ POS\_k\ \ \ \ \ \ \ (POS\_A\ +\ SIZE\_A)}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#define\ POS\_B\ \ \ \ \ \ \ (POS\_k\ +\ 1)}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#define\ POS\_vB\ \ \ \ \ \ (POS\_k\ +\ 1)}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#define\ POS\_C\ \ \ \ \ \ \ (POS\_B\ +\ SIZE\_B)}}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#define\ POS\_vC\ \ \ \ \ \ (POS\_vB\ +\ SIZE\_vB)}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#define\ POS\_Bx\ \ \ \ \ \ POS\_k}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#define\ POS\_Ax\ \ \ \ \ \ POS\_A}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#define\ POS\_sJ\ \ \ \ \ \ POS\_A}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{/*}}
\DoxyCodeLine{00069\ \textcolor{comment}{**\ limits\ for\ opcode\ arguments.}}
\DoxyCodeLine{00070\ \textcolor{comment}{**\ we\ use\ (signed)\ 'int'\ to\ manipulate\ most\ arguments,}}
\DoxyCodeLine{00071\ \textcolor{comment}{**\ so\ they\ must\ fit\ in\ ints.}}
\DoxyCodeLine{00072\ \textcolor{comment}{*/}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{comment}{/*}}
\DoxyCodeLine{00075\ \textcolor{comment}{**\ Check\ whether\ type\ 'int'\ has\ at\ least\ 'b'\ +\ 1\ bits.}}
\DoxyCodeLine{00076\ \textcolor{comment}{**\ 'b'\ <\ 32;\ +1\ for\ the\ sign\ bit.}}
\DoxyCodeLine{00077\ \textcolor{comment}{*/}}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#define\ L\_INTHASBITS(b)\ \ \ \ \ ((UINT\_MAX\ >>\ (b))\ >=\ 1)}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \textcolor{preprocessor}{\#if\ L\_INTHASBITS(SIZE\_Bx)}}
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#define\ MAXARG\_Bx\ \ \ ((1<<SIZE\_Bx)-\/1)}}
\DoxyCodeLine{00083\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#define\ MAXARG\_Bx\ \ \ MAX\_INT}}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#define\ OFFSET\_sBx\ \ (MAXARG\_Bx>>1)\ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ 'sBx'\ is\ signed\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#if\ L\_INTHASBITS(SIZE\_Ax)}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#define\ MAXARG\_Ax\ \ \ ((1<<SIZE\_Ax)-\/1)}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#define\ MAXARG\_Ax\ \ \ MAX\_INT}}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#if\ L\_INTHASBITS(SIZE\_sJ)}}
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#define\ MAXARG\_sJ\ \ \ ((1\ <<\ SIZE\_sJ)\ -\/\ 1)}}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\#define\ MAXARG\_sJ\ \ \ MAX\_INT}}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#define\ OFFSET\_sJ\ \ \ (MAXARG\_sJ\ >>\ 1)}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{preprocessor}{\#define\ MAXARG\_A\ \ \ \ ((1<<SIZE\_A)-\/1)}}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#define\ MAXARG\_B\ \ \ \ ((1<<SIZE\_B)-\/1)}}
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#define\ MAXARG\_vB\ \ \ ((1<<SIZE\_vB)-\/1)}}
\DoxyCodeLine{00108\ \textcolor{preprocessor}{\#define\ MAXARG\_C\ \ \ \ ((1<<SIZE\_C)-\/1)}}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#define\ MAXARG\_vC\ \ \ ((1<<SIZE\_vC)-\/1)}}
\DoxyCodeLine{00110\ \textcolor{preprocessor}{\#define\ OFFSET\_sC\ \ \ (MAXARG\_C\ >>\ 1)}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#define\ int2sC(i)\ \ \ ((i)\ +\ OFFSET\_sC)}}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#define\ sC2int(i)\ \ \ ((i)\ -\/\ OFFSET\_sC)}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{comment}{/*\ creates\ a\ mask\ with\ 'n'\ 1\ bits\ at\ position\ 'p'\ */}}
\DoxyCodeLine{00117\ \textcolor{preprocessor}{\#define\ MASK1(n,p)\ \ ((\string~((\string~(Instruction)0)<<(n)))<<(p))}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \textcolor{comment}{/*\ creates\ a\ mask\ with\ 'n'\ 0\ bits\ at\ position\ 'p'\ */}}
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\#define\ MASK0(n,p)\ \ (\string~MASK1(n,p))}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \textcolor{comment}{/*}}
\DoxyCodeLine{00123\ \textcolor{comment}{**\ the\ following\ macros\ help\ to\ manipulate\ instructions}}
\DoxyCodeLine{00124\ \textcolor{comment}{*/}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#define\ GET\_OPCODE(i)\ \ \ (cast(OpCode,\ ((i)>>POS\_OP)\ \&\ MASK1(SIZE\_OP,0)))}}
\DoxyCodeLine{00127\ \textcolor{preprocessor}{\#define\ SET\_OPCODE(i,o)\ ((i)\ =\ (((i)\&MASK0(SIZE\_OP,POS\_OP))\ |\ \(\backslash\)}}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ((cast(Instruction,\ o)<<POS\_OP)\&MASK1(SIZE\_OP,POS\_OP))))}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{preprocessor}{\#define\ checkopm(i,m)\ \ \ (getOpMode(GET\_OPCODE(i))\ ==\ m)}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \textcolor{preprocessor}{\#define\ getarg(i,pos,size)\ \ (cast\_int(((i)>>(pos))\ \&\ MASK1(size,0)))}}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#define\ setarg(i,v,pos,size)\ \ \ \ ((i)\ =\ (((i)\&MASK0(size,pos))\ |\ \(\backslash\)}}
\DoxyCodeLine{00135\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((cast(Instruction,\ v)<<pos)\&MASK1(size,pos))))}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \textcolor{preprocessor}{\#define\ GETARG\_A(i)\ getarg(i,\ POS\_A,\ SIZE\_A)}}
\DoxyCodeLine{00138\ \textcolor{preprocessor}{\#define\ SETARG\_A(i,v)\ \ \ setarg(i,\ v,\ POS\_A,\ SIZE\_A)}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{preprocessor}{\#define\ GETARG\_B(i)\ \ \(\backslash\)}}
\DoxyCodeLine{00141\ \textcolor{preprocessor}{\ \ \ \ check\_exp(checkopm(i,\ iABC),\ getarg(i,\ POS\_B,\ SIZE\_B))}}
\DoxyCodeLine{00142\ \textcolor{preprocessor}{\#define\ GETARG\_vB(i)\ \ \(\backslash\)}}
\DoxyCodeLine{00143\ \textcolor{preprocessor}{\ \ \ \ check\_exp(checkopm(i,\ ivABC),\ getarg(i,\ POS\_vB,\ SIZE\_vB))}}
\DoxyCodeLine{00144\ \textcolor{preprocessor}{\#define\ GETARG\_sB(i)\ \ \ \ sC2int(GETARG\_B(i))}}
\DoxyCodeLine{00145\ \textcolor{preprocessor}{\#define\ SETARG\_B(i,v)\ \ \ setarg(i,\ v,\ POS\_B,\ SIZE\_B)}}
\DoxyCodeLine{00146\ \textcolor{preprocessor}{\#define\ SETARG\_vB(i,v)\ \ setarg(i,\ v,\ POS\_vB,\ SIZE\_vB)}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \textcolor{preprocessor}{\#define\ GETARG\_C(i)\ \ \(\backslash\)}}
\DoxyCodeLine{00149\ \textcolor{preprocessor}{\ \ \ \ check\_exp(checkopm(i,\ iABC),\ getarg(i,\ POS\_C,\ SIZE\_C))}}
\DoxyCodeLine{00150\ \textcolor{preprocessor}{\#define\ GETARG\_vC(i)\ \ \(\backslash\)}}
\DoxyCodeLine{00151\ \textcolor{preprocessor}{\ \ \ \ check\_exp(checkopm(i,\ ivABC),\ getarg(i,\ POS\_vC,\ SIZE\_vC))}}
\DoxyCodeLine{00152\ \textcolor{preprocessor}{\#define\ GETARG\_sC(i)\ \ \ \ sC2int(GETARG\_C(i))}}
\DoxyCodeLine{00153\ \textcolor{preprocessor}{\#define\ SETARG\_C(i,v)\ \ \ setarg(i,\ v,\ POS\_C,\ SIZE\_C)}}
\DoxyCodeLine{00154\ \textcolor{preprocessor}{\#define\ SETARG\_vC(i,v)\ \ setarg(i,\ v,\ POS\_vC,\ SIZE\_vC)}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \textcolor{preprocessor}{\#define\ TESTARG\_k(i)\ \ \ \ check\_exp(checkopm(i,\ iABC),\ (cast\_int(((i)\ \&\ (1u\ <<\ POS\_k)))))}}
\DoxyCodeLine{00157\ \textcolor{preprocessor}{\#define\ GETARG\_k(i)\ check\_exp(checkopm(i,\ iABC),\ getarg(i,\ POS\_k,\ 1))}}
\DoxyCodeLine{00158\ \textcolor{preprocessor}{\#define\ SETARG\_k(i,v)\ \ \ setarg(i,\ v,\ POS\_k,\ 1)}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#define\ GETARG\_Bx(i)\ \ \ \ check\_exp(checkopm(i,\ iABx),\ getarg(i,\ POS\_Bx,\ SIZE\_Bx))}}
\DoxyCodeLine{00161\ \textcolor{preprocessor}{\#define\ SETARG\_Bx(i,v)\ \ setarg(i,\ v,\ POS\_Bx,\ SIZE\_Bx)}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\#define\ GETARG\_Ax(i)\ \ \ \ check\_exp(checkopm(i,\ iAx),\ getarg(i,\ POS\_Ax,\ SIZE\_Ax))}}
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\#define\ SETARG\_Ax(i,v)\ \ setarg(i,\ v,\ POS\_Ax,\ SIZE\_Ax)}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \textcolor{preprocessor}{\#define\ GETARG\_sBx(i)\ \ \(\backslash\)}}
\DoxyCodeLine{00167\ \textcolor{preprocessor}{\ \ \ \ check\_exp(checkopm(i,\ iAsBx),\ getarg(i,\ POS\_Bx,\ SIZE\_Bx)\ -\/\ OFFSET\_sBx)}}
\DoxyCodeLine{00168\ \textcolor{preprocessor}{\#define\ SETARG\_sBx(i,b)\ SETARG\_Bx((i),cast\_uint((b)+OFFSET\_sBx))}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \textcolor{preprocessor}{\#define\ GETARG\_sJ(i)\ \ \(\backslash\)}}
\DoxyCodeLine{00171\ \textcolor{preprocessor}{\ \ \ \ check\_exp(checkopm(i,\ isJ),\ getarg(i,\ POS\_sJ,\ SIZE\_sJ)\ -\/\ OFFSET\_sJ)}}
\DoxyCodeLine{00172\ \textcolor{preprocessor}{\#define\ SETARG\_sJ(i,j)\ \(\backslash\)}}
\DoxyCodeLine{00173\ \textcolor{preprocessor}{\ \ \ \ setarg(i,\ cast\_uint((j)+OFFSET\_sJ),\ POS\_sJ,\ SIZE\_sJ)}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \textcolor{preprocessor}{\#define\ CREATE\_ABCk(o,a,b,c,k)\ \ ((cast(Instruction,\ o)<<POS\_OP)\ \(\backslash\)}}
\DoxyCodeLine{00177\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ a)<<POS\_A)\ \(\backslash\)}}
\DoxyCodeLine{00178\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ b)<<POS\_B)\ \(\backslash\)}}
\DoxyCodeLine{00179\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ c)<<POS\_C)\ \(\backslash\)}}
\DoxyCodeLine{00180\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ k)<<POS\_k))}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \textcolor{preprocessor}{\#define\ CREATE\_vABCk(o,a,b,c,k)\ ((cast(Instruction,\ o)<<POS\_OP)\ \(\backslash\)}}
\DoxyCodeLine{00183\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ a)<<POS\_A)\ \(\backslash\)}}
\DoxyCodeLine{00184\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ b)<<POS\_vB)\ \(\backslash\)}}
\DoxyCodeLine{00185\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ c)<<POS\_vC)\ \(\backslash\)}}
\DoxyCodeLine{00186\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ k)<<POS\_k))}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \textcolor{preprocessor}{\#define\ CREATE\_ABx(o,a,bc)\ \ ((cast(Instruction,\ o)<<POS\_OP)\ \(\backslash\)}}
\DoxyCodeLine{00189\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ a)<<POS\_A)\ \(\backslash\)}}
\DoxyCodeLine{00190\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ bc)<<POS\_Bx))}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\#define\ CREATE\_Ax(o,a)\ \ \ \ \ \ ((cast(Instruction,\ o)<<POS\_OP)\ \(\backslash\)}}
\DoxyCodeLine{00193\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ a)<<POS\_Ax))}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \textcolor{preprocessor}{\#define\ CREATE\_sJ(o,j,k)\ \ \ \ ((cast(Instruction,\ o)\ <<\ POS\_OP)\ \(\backslash\)}}
\DoxyCodeLine{00196\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ j)\ <<\ POS\_sJ)\ \(\backslash\)}}
\DoxyCodeLine{00197\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ |\ (cast(Instruction,\ k)\ <<\ POS\_k))}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \textcolor{preprocessor}{\#if\ !defined(MAXINDEXRK)\ \ }\textcolor{comment}{/*\ (for\ debugging\ only)\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#define\ MAXINDEXRK\ \ MAXARG\_B}}
\DoxyCodeLine{00202\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \textcolor{comment}{/*}}
\DoxyCodeLine{00206\ \textcolor{comment}{**\ Maximum\ size\ for\ the\ stack\ of\ a\ Lua\ function.\ It\ must\ fit\ in\ 8\ bits.}}
\DoxyCodeLine{00207\ \textcolor{comment}{**\ The\ highest\ valid\ register\ is\ one\ less\ than\ this\ value.}}
\DoxyCodeLine{00208\ \textcolor{comment}{*/}}
\DoxyCodeLine{00209\ \textcolor{preprocessor}{\#define\ MAX\_FSTACK\ \ MAXARG\_A}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \textcolor{comment}{/*}}
\DoxyCodeLine{00212\ \textcolor{comment}{**\ Invalid\ register\ (one\ more\ than\ last\ valid\ register).}}
\DoxyCodeLine{00213\ \textcolor{comment}{*/}}
\DoxyCodeLine{00214\ \textcolor{preprocessor}{\#define\ NO\_REG\ \ \ \ \ \ MAX\_FSTACK}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \textcolor{comment}{/*}}
\DoxyCodeLine{00219\ \textcolor{comment}{**\ R[x]\ -\/\ register}}
\DoxyCodeLine{00220\ \textcolor{comment}{**\ K[x]\ -\/\ constant\ (in\ constant\ table)}}
\DoxyCodeLine{00221\ \textcolor{comment}{**\ RK(x)\ ==\ if\ k(i)\ then\ K[x]\ else\ R[x]}}
\DoxyCodeLine{00222\ \textcolor{comment}{*/}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \textcolor{comment}{/*}}
\DoxyCodeLine{00226\ \textcolor{comment}{**\ Grep\ "{}ORDER\ OP"{}\ if\ you\ change\ this\ enum.}}
\DoxyCodeLine{00227\ \textcolor{comment}{**\ See\ "{}Notes"{}\ below\ for\ more\ information\ about\ some\ instructions.}}
\DoxyCodeLine{00228\ \textcolor{comment}{*/}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00231\ \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00232\ \textcolor{comment}{\ \ name\ \ \ \ \ \ args\ \ \ \ description}}
\DoxyCodeLine{00233\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00234\ OP\_MOVE,\textcolor{comment}{/*\ \ A\ B\ R[A]\ :=\ R[B]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00235\ OP\_LOADI,\textcolor{comment}{/*\ A\ sBx\ \ \ R[A]\ :=\ sBx\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00236\ OP\_LOADF,\textcolor{comment}{/*\ A\ sBx\ \ \ R[A]\ :=\ (lua\_Number)sBx\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00237\ OP\_LOADK,\textcolor{comment}{/*\ A\ Bx\ \ \ \ R[A]\ :=\ K[Bx]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00238\ OP\_LOADKX,\textcolor{comment}{/*\ \ \ \ A\ \ \ R[A]\ :=\ K[extra\ arg]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00239\ OP\_LOADFALSE,\textcolor{comment}{/*\ A\ \ \ R[A]\ :=\ false\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00240\ OP\_LFALSESKIP,\textcolor{comment}{/*A\ \ \ R[A]\ :=\ false;\ pc++\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00241\ OP\_LOADTRUE,\textcolor{comment}{/*\ \ A\ \ \ R[A]\ :=\ true\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00242\ OP\_LOADNIL,\textcolor{comment}{/*\ \ \ A\ B\ R[A],\ R[A+1],\ ...,\ R[A+B]\ :=\ nil\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00243\ OP\_GETUPVAL,\textcolor{comment}{/*\ \ A\ B\ R[A]\ :=\ UpValue[B]\ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00244\ OP\_SETUPVAL,\textcolor{comment}{/*\ \ A\ B\ UpValue[B]\ :=\ R[A]\ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ OP\_GETTABUP,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ UpValue[B][K[C]:shortstring]\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00247\ OP\_GETTABLE,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B][R[C]]\ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00248\ OP\_GETI,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B][C]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00249\ OP\_GETFIELD,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B][K[C]:shortstring]\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ OP\_SETTABUP,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ UpValue[A][K[B]:shortstring]\ :=\ RK(C)\ \ \ \ \ \ \ */}}
\DoxyCodeLine{00252\ OP\_SETTABLE,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A][R[B]]\ :=\ RK(C)\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00253\ OP\_SETI,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A][B]\ :=\ RK(C)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00254\ OP\_SETFIELD,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A][K[B]:shortstring]\ :=\ RK(C)\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ OP\_NEWTABLE,\textcolor{comment}{/*\ \ A\ vB\ vC\ k\ \ \ R[A]\ :=\ \{\}\ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ OP\_SELF,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A+1]\ :=\ R[B];\ R[A]\ :=\ R[B][K[C]:shortstring]\ \ */}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ OP\_ADDI,\textcolor{comment}{/*\ \ A\ B\ sC\ \ R[A]\ :=\ R[B]\ +\ sC\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ OP\_ADDK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ +\ K[C]:number\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00263\ OP\_SUBK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ -\/\ K[C]:number\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00264\ OP\_MULK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ *\ K[C]:number\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00265\ OP\_MODK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \%\ K[C]:number\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00266\ OP\_POWK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \string^\ K[C]:number\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00267\ OP\_DIVK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ /\ K[C]:number\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00268\ OP\_IDIVK,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ //\ K[C]:number\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ OP\_BANDK,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \&\ K[C]:integer\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00271\ OP\_BORK,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ |\ K[C]:integer\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00272\ OP\_BXORK,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \string~\ K[C]:integer\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ OP\_SHLI,\textcolor{comment}{/*\ \ A\ B\ sC\ \ R[A]\ :=\ sC\ <<\ R[B]\ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00275\ OP\_SHRI,\textcolor{comment}{/*\ \ A\ B\ sC\ \ R[A]\ :=\ R[B]\ >>\ sC\ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ OP\_ADD,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ +\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00278\ OP\_SUB,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ -\/\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00279\ OP\_MUL,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ *\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00280\ OP\_MOD,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \%\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00281\ OP\_POW,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \string^\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00282\ OP\_DIV,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ /\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00283\ OP\_IDIV,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ //\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ OP\_BAND,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \&\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00286\ OP\_BOR,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ |\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00287\ OP\_BXOR,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ \string~\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00288\ OP\_SHL,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ <<\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00289\ OP\_SHR,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ >>\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ OP\_SPACESHIP,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ <=>\ R[C]\ (返回-\/1,0,1)\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ OP\_MMBIN,\textcolor{comment}{/*\ A\ B\ C\ \ \ call\ C\ metamethod\ over\ R[A]\ and\ R[B]\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00294\ OP\_MMBINI,\textcolor{comment}{/*\ \ \ \ A\ sB\ C\ k\ \ \ \ call\ C\ metamethod\ over\ R[A]\ and\ sB\ \ */}}
\DoxyCodeLine{00295\ OP\_MMBINK,\textcolor{comment}{/*\ \ \ \ A\ B\ C\ k\ \ \ \ \ call\ C\ metamethod\ over\ R[A]\ and\ K[B]\ \ \ \ */}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ OP\_UNM,\textcolor{comment}{/*\ \ \ A\ B\ R[A]\ :=\ -\/R[B]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00298\ OP\_BNOT,\textcolor{comment}{/*\ \ A\ B\ R[A]\ :=\ \string~R[B]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00299\ OP\_NOT,\textcolor{comment}{/*\ \ \ A\ B\ R[A]\ :=\ not\ R[B]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00300\ OP\_LEN,\textcolor{comment}{/*\ \ \ A\ B\ R[A]\ :=\ \#R[B]\ (length\ operator)\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ OP\_CONCAT,\textcolor{comment}{/*\ \ \ \ A\ B\ R[A]\ :=\ R[A]..\ ...\ ..R[A\ +\ B\ -\/\ 1]\ \ \ \ \ \ \ */}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ OP\_CLOSE,\textcolor{comment}{/*\ A\ \ \ close\ all\ upvalues\ >=\ R[A]\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00305\ OP\_TBC,\textcolor{comment}{/*\ \ \ A\ \ \ mark\ variable\ A\ "{}to\ be\ close"{}\ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00306\ OP\_JMP,\textcolor{comment}{/*\ \ \ sJ\ \ pc\ +=\ sJ\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00307\ OP\_EQ,\textcolor{comment}{/*\ \ \ \ A\ B\ k\ \ \ if\ ((R[A]\ ==\ R[B])\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ */}}
\DoxyCodeLine{00308\ OP\_LT,\textcolor{comment}{/*\ \ \ \ A\ B\ k\ \ \ if\ ((R[A]\ <\ \ R[B])\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ */}}
\DoxyCodeLine{00309\ OP\_LE,\textcolor{comment}{/*\ \ \ \ A\ B\ k\ \ \ if\ ((R[A]\ <=\ R[B])\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ */}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ OP\_EQK,\textcolor{comment}{/*\ \ \ A\ B\ k\ \ \ if\ ((R[A]\ ==\ K[B])\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ */}}
\DoxyCodeLine{00312\ OP\_EQI,\textcolor{comment}{/*\ \ \ A\ sB\ k\ \ if\ ((R[A]\ ==\ sB)\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00313\ OP\_LTI,\textcolor{comment}{/*\ \ \ A\ sB\ k\ \ if\ ((R[A]\ <\ sB)\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00314\ OP\_LEI,\textcolor{comment}{/*\ \ \ A\ sB\ k\ \ if\ ((R[A]\ <=\ sB)\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00315\ OP\_GTI,\textcolor{comment}{/*\ \ \ A\ sB\ k\ \ if\ ((R[A]\ >\ sB)\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00316\ OP\_GEI,\textcolor{comment}{/*\ \ \ A\ sB\ k\ \ if\ ((R[A]\ >=\ sB)\ \string~=\ k)\ then\ pc++\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ OP\_TEST,\textcolor{comment}{/*\ \ A\ k\ if\ (not\ R[A]\ ==\ k)\ then\ pc++\ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00319\ OP\_TESTSET,\textcolor{comment}{/*\ \ \ A\ B\ k\ \ \ if\ (not\ R[B]\ ==\ k)\ then\ pc++\ else\ R[A]\ :=\ R[B]\ \ */}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ OP\_CALL,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A],\ ...\ ,R[A+C-\/2]\ :=\ R[A](R[A+1],\ ...\ ,R[A+B-\/1])\ */}}
\DoxyCodeLine{00323\ OP\_TAILCALL,\textcolor{comment}{/*\ \ A\ B\ C\ k\ return\ R[A](R[A+1],\ ...\ ,R[A+B-\/1])\ \ \ \ \ \ */}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ OP\_RETURN,\textcolor{comment}{/*\ \ \ \ A\ B\ C\ k\ return\ R[A],\ ...\ ,R[A+B-\/2]\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00326\ OP\_RETURN0,\textcolor{comment}{/*\ \ \ \ \ \ \ return\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00327\ OP\_RETURN1,\textcolor{comment}{/*\ \ \ A\ \ \ return\ R[A]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ OP\_FORLOOP,\textcolor{comment}{/*\ \ \ A\ Bx\ \ \ \ update\ counters;\ if\ loop\ continues\ then\ pc-\/=Bx;\ */}}
\DoxyCodeLine{00330\ OP\_FORPREP,\textcolor{comment}{/*\ \ \ A\ Bx\ \ \ \ <check\ values\ and\ prepare\ counters>;}}
\DoxyCodeLine{00331\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ not\ to\ run\ then\ pc+=Bx+1;\ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ OP\_TFORPREP,\textcolor{comment}{/*\ \ A\ Bx\ \ \ \ create\ upvalue\ for\ R[A\ +\ 3];\ pc+=Bx\ \ \ \ \ */}}
\DoxyCodeLine{00334\ OP\_TFORCALL,\textcolor{comment}{/*\ \ A\ C\ R[A+4],\ ...\ ,R[A+3+C]\ :=\ R[A](R[A+1],\ R[A+2]);\ \ */}}
\DoxyCodeLine{00335\ OP\_TFORLOOP,\textcolor{comment}{/*\ \ A\ Bx\ \ \ \ if\ R[A+2]\ \string~=\ nil\ then\ \{\ R[A]=R[A+2];\ pc\ -\/=\ Bx\ \}\ */}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ OP\_SETLIST,\textcolor{comment}{/*\ \ \ A\ vB\ vC\ k\ \ \ R[A][vC+i]\ :=\ R[A+i],\ 1\ <=\ i\ <=\ vB\ \ */}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ OP\_CLOSURE,\textcolor{comment}{/*\ \ \ A\ Bx\ \ \ \ R[A]\ :=\ closure(KPROTO[Bx])\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ OP\_VARARG,\textcolor{comment}{/*\ \ \ \ A\ B\ C\ k\ R[A],\ ...,\ R[A+C-\/2]\ =\ varargs\ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ OP\_GETVARG,\ \textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B][R[C]],\ R[B]\ is\ vararg\ parameter\ \ \ \ */}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ OP\_ERRNNIL,\textcolor{comment}{/*\ \ \ A\ Bx\ \ \ \ raise\ error\ if\ R[A]\ \string~=\ nil\ (K[Bx\ -\/\ 1]\ is\ global\ name)*/}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ OP\_VARARGPREP,\textcolor{comment}{/*\ \ \ \ (adjust\ varargs)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ OP\_IS,\textcolor{comment}{/*\ \ \ \ A\ B\ C\ k\ if\ ((type(R[A])\ ==\ K[B])\ \string~=\ k)\ then\ pc++\ \ \ \ */}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ OP\_TESTNIL,\textcolor{comment}{/*\ \ \ A\ B\ k\ \ \ if\ (R[B]\ is\ nil)\ ==\ k\ then\ pc++\ else\ R[A]\ :=\ R[B]\ \ \ */}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00354\ \textcolor{comment}{\ \ 面向对象系统操作码}}
\DoxyCodeLine{00355\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00356\ OP\_NEWCLASS,\textcolor{comment}{/*\ \ A\ Bx\ \ \ \ R[A]\ :=\ 创建新类，类名为K[Bx]\ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00357\ OP\_INHERIT,\textcolor{comment}{/*\ \ \ A\ B\ R[A].\_\_parent\ :=\ R[B]，设置类继承关系\ \ \ \ \ \ \ */}}
\DoxyCodeLine{00358\ OP\_GETSUPER,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ R[B].\_\_parent[K[C]:shortstring]\ 调用父类方法\ \ */}}
\DoxyCodeLine{00359\ OP\_SETMETHOD,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A][K[B]:shortstring]\ :=\ R[C]，设置类方法\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00360\ OP\_SETSTATIC,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A].\_\_static[K[B]:shortstring]\ :=\ R[C]，设置静态成员\ \ */}}
\DoxyCodeLine{00361\ OP\_NEWOBJ,\textcolor{comment}{/*\ \ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]()，使用R[B]类创建新对象，参数C个\ \ \ \ */}}
\DoxyCodeLine{00362\ OP\_GETPROP,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B][K[C]:shortstring]，获取属性（考虑继承链）*/}}
\DoxyCodeLine{00363\ OP\_SETPROP,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ R[A][K[B]:shortstring]\ :=\ RK(C)，设置对象属性\ \ */}}
\DoxyCodeLine{00364\ OP\_INSTANCEOF,\textcolor{comment}{/*A\ B\ C\ k\ if\ ((R[A]\ instanceof\ R[B])\ \string~=\ k)\ then\ pc++\ \ */}}
\DoxyCodeLine{00365\ OP\_IMPLEMENT,\textcolor{comment}{/*\ A\ B\ R[A]\ implements\ R[B]，类实现接口\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00366\ OP\_SETIFACEFLAG,\textcolor{comment}{/*A\ 设置R[A]为接口（设置CLASS\_FLAG\_INTERFACE）\ \ \ */}}
\DoxyCodeLine{00367\ OP\_ADDMETHOD,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A].\_\_methods[K[B]]\ :=\ K[C]，添加接口方法签名\ \ \ */}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ OP\_IN,\textcolor{comment}{/*\ \ \ \ A\ B\ C\ \ \ R[A]\ :=\ R[B]\ in\ R[C]\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00372\ \textcolor{comment}{\ \ 切片操作码\ -\/\ 支持\ Python\ 风格的切片语法\ t[start:end:step]}}
\DoxyCodeLine{00373\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00374\ OP\_SLICE,\textcolor{comment}{/*\ A\ B\ C\ \ \ R[A]\ :=\ slice(R[B],\ R[B+1],\ R[B+2],\ R[B+3])}}
\DoxyCodeLine{00375\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ B\ =\ 源表寄存器}}
\DoxyCodeLine{00376\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ B+1\ =\ start\ (起始索引，nil表示1)}}
\DoxyCodeLine{00377\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ B+2\ =\ end\ (结束索引，nil表示\#t)}}
\DoxyCodeLine{00378\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ B+3\ =\ step\ (步长，nil表示1)}}
\DoxyCodeLine{00379\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ C\ =\ 标志位：0=普通切片，1=有步长\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ OP\_NOP,\textcolor{comment}{/*\ \ \ A\ B\ C\ \ \ 空操作指令\ -\/\ 不执行任何操作}}
\DoxyCodeLine{00382\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ 用于控制流混淆占位，A/B/C参数可携带虚假数据干扰反编译}}
\DoxyCodeLine{00383\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ A\ =\ 虚假寄存器索引（被忽略）}}
\DoxyCodeLine{00384\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ B\ =\ 虚假操作数1（被忽略）}}
\DoxyCodeLine{00385\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ C\ =\ 虚假操作数2（被忽略）\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ OP\_CASE,\textcolor{comment}{/*\ \ A\ B\ C\ \ \ R[A]\ :=\ \{\ R[B],\ R[C]\ \}\ (create\ case\ pair)\ \ \ */}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ OP\_EXTRAARG\textcolor{comment}{/*\ \ \ Ax\ \ extra\ (larger)\ argument\ for\ previous\ opcode\ */}}
\DoxyCodeLine{00390\ \}\ OpCode;}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \textcolor{preprocessor}{\#define\ NUM\_OPCODES\ ((int)(OP\_EXTRAARG)\ +\ 1)}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \textcolor{comment}{/*================================================================}}
\DoxyCodeLine{00398\ \textcolor{comment}{\ \ Notes:}}
\DoxyCodeLine{00399\ \textcolor{comment}{}}
\DoxyCodeLine{00400\ \textcolor{comment}{\ \ (*)\ Opcode\ OP\_LFALSESKIP\ is\ used\ to\ convert\ a\ condition\ to\ a\ boolean}}
\DoxyCodeLine{00401\ \textcolor{comment}{\ \ value,\ in\ a\ code\ equivalent\ to\ (not\ cond\ ?\ false\ :\ true).\ \ (It}}
\DoxyCodeLine{00402\ \textcolor{comment}{\ \ produces\ false\ and\ skips\ the\ next\ instruction\ producing\ true.)}}
\DoxyCodeLine{00403\ \textcolor{comment}{}}
\DoxyCodeLine{00404\ \textcolor{comment}{\ \ (*)\ Opcodes\ OP\_MMBIN\ and\ variants\ follow\ each\ arithmetic\ and}}
\DoxyCodeLine{00405\ \textcolor{comment}{\ \ bitwise\ opcode.\ If\ the\ operation\ succeeds,\ it\ skips\ this\ next}}
\DoxyCodeLine{00406\ \textcolor{comment}{\ \ opcode.\ Otherwise,\ this\ opcode\ calls\ the\ corresponding\ metamethod.}}
\DoxyCodeLine{00407\ \textcolor{comment}{}}
\DoxyCodeLine{00408\ \textcolor{comment}{\ \ (*)\ Opcode\ OP\_TESTSET\ is\ used\ in\ short-\/circuit\ expressions\ that\ need}}
\DoxyCodeLine{00409\ \textcolor{comment}{\ \ both\ to\ jump\ and\ to\ produce\ a\ value,\ such\ as\ (a\ =\ b\ or\ c).}}
\DoxyCodeLine{00410\ \textcolor{comment}{}}
\DoxyCodeLine{00411\ \textcolor{comment}{\ \ (*)\ In\ OP\_CALL,\ if\ (B\ ==\ 0)\ then\ B\ =\ top\ -\/\ A.\ If\ (C\ ==\ 0),\ then}}
\DoxyCodeLine{00412\ \textcolor{comment}{\ \ 'top'\ is\ set\ to\ last\_result+1,\ so\ next\ open\ instruction\ (OP\_CALL,}}
\DoxyCodeLine{00413\ \textcolor{comment}{\ \ OP\_RETURN*,\ OP\_SETLIST)\ may\ use\ 'top'.}}
\DoxyCodeLine{00414\ \textcolor{comment}{}}
\DoxyCodeLine{00415\ \textcolor{comment}{\ \ (*)\ In\ OP\_VARARG,\ if\ (C\ ==\ 0)\ then\ use\ actual\ number\ of\ varargs\ and}}
\DoxyCodeLine{00416\ \textcolor{comment}{\ \ set\ top\ (like\ in\ OP\_CALL\ with\ C\ ==\ 0).\ 'k'\ means\ function\ has\ a}}
\DoxyCodeLine{00417\ \textcolor{comment}{\ \ vararg\ table,\ which\ is\ in\ R[B].}}
\DoxyCodeLine{00418\ \textcolor{comment}{}}
\DoxyCodeLine{00419\ \textcolor{comment}{\ \ (*)\ In\ OP\_RETURN,\ if\ (B\ ==\ 0)\ then\ return\ up\ to\ 'top'.}}
\DoxyCodeLine{00420\ \textcolor{comment}{}}
\DoxyCodeLine{00421\ \textcolor{comment}{\ \ (*)\ In\ OP\_LOADKX\ and\ OP\_NEWTABLE,\ the\ next\ instruction\ is\ always}}
\DoxyCodeLine{00422\ \textcolor{comment}{\ \ OP\_EXTRAARG.}}
\DoxyCodeLine{00423\ \textcolor{comment}{}}
\DoxyCodeLine{00424\ \textcolor{comment}{\ \ (*)\ In\ OP\_SETLIST,\ if\ (B\ ==\ 0)\ then\ real\ B\ =\ 'top';\ if\ k,\ then}}
\DoxyCodeLine{00425\ \textcolor{comment}{\ \ real\ C\ =\ EXTRAARG\ \_\ C\ (the\ bits\ of\ EXTRAARG\ concatenated\ with\ the}}
\DoxyCodeLine{00426\ \textcolor{comment}{\ \ bits\ of\ C).}}
\DoxyCodeLine{00427\ \textcolor{comment}{}}
\DoxyCodeLine{00428\ \textcolor{comment}{\ \ (*)\ In\ OP\_NEWTABLE,\ vB\ is\ log2\ of\ the\ hash\ size\ (which\ is\ always\ a}}
\DoxyCodeLine{00429\ \textcolor{comment}{\ \ power\ of\ 2)\ plus\ 1,\ or\ zero\ for\ size\ zero.\ If\ not\ k,\ the\ array\ size}}
\DoxyCodeLine{00430\ \textcolor{comment}{\ \ is\ vC.\ Otherwise,\ the\ array\ size\ is\ EXTRAARG\ \_\ vC.}}
\DoxyCodeLine{00431\ \textcolor{comment}{}}
\DoxyCodeLine{00432\ \textcolor{comment}{\ \ (*)\ In\ OP\_ERRNNIL,\ (Bx\ ==\ 0)\ means\ index\ of\ global\ name\ doesn't}}
\DoxyCodeLine{00433\ \textcolor{comment}{\ \ fit\ in\ Bx.\ (So,\ that\ name\ is\ not\ available\ for\ the\ error\ message.)}}
\DoxyCodeLine{00434\ \textcolor{comment}{}}
\DoxyCodeLine{00435\ \textcolor{comment}{\ \ (*)\ For\ comparisons,\ k\ specifies\ what\ condition\ the\ test\ should\ accept}}
\DoxyCodeLine{00436\ \textcolor{comment}{\ \ (true\ or\ false).}}
\DoxyCodeLine{00437\ \textcolor{comment}{}}
\DoxyCodeLine{00438\ \textcolor{comment}{\ \ (*)\ In\ OP\_MMBINI/OP\_MMBINK,\ k\ means\ the\ arguments\ were\ flipped}}
\DoxyCodeLine{00439\ \textcolor{comment}{\ \ (the\ constant\ is\ the\ first\ operand).}}
\DoxyCodeLine{00440\ \textcolor{comment}{}}
\DoxyCodeLine{00441\ \textcolor{comment}{\ \ (*)\ All\ comparison\ and\ test\ instructions\ assume\ that\ the\ instruction}}
\DoxyCodeLine{00442\ \textcolor{comment}{\ \ being\ skipped\ (pc++)\ is\ a\ jump.}}
\DoxyCodeLine{00443\ \textcolor{comment}{}}
\DoxyCodeLine{00444\ \textcolor{comment}{\ \ (*)\ In\ instructions\ OP\_RETURN/OP\_TAILCALL,\ 'k'\ specifies\ that\ the}}
\DoxyCodeLine{00445\ \textcolor{comment}{\ \ function\ builds\ upvalues,\ which\ may\ need\ to\ be\ closed.\ C\ >\ 0\ means}}
\DoxyCodeLine{00446\ \textcolor{comment}{\ \ the\ function\ has\ hidden\ vararg\ arguments,\ so\ that\ its\ 'func'\ must\ be}}
\DoxyCodeLine{00447\ \textcolor{comment}{\ \ corrected\ before\ returning;\ in\ this\ case,\ (C\ -\/\ 1)\ is\ its\ number\ of}}
\DoxyCodeLine{00448\ \textcolor{comment}{\ \ fixed\ parameters.}}
\DoxyCodeLine{00449\ \textcolor{comment}{}}
\DoxyCodeLine{00450\ \textcolor{comment}{\ \ (*)\ In\ comparisons\ with\ an\ immediate\ operand,\ C\ signals\ whether\ the}}
\DoxyCodeLine{00451\ \textcolor{comment}{\ \ original\ operand\ was\ a\ float.\ (It\ must\ be\ corrected\ in\ case\ of}}
\DoxyCodeLine{00452\ \textcolor{comment}{\ \ metamethods.)}}
\DoxyCodeLine{00453\ \textcolor{comment}{}}
\DoxyCodeLine{00454\ \textcolor{comment}{================================================================*/}}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \textcolor{comment}{/*}}
\DoxyCodeLine{00458\ \textcolor{comment}{**\ masks\ for\ instruction\ properties.\ The\ format\ is:}}
\DoxyCodeLine{00459\ \textcolor{comment}{**\ bits\ 0-\/2:\ op\ mode}}
\DoxyCodeLine{00460\ \textcolor{comment}{**\ bit\ 3:\ instruction\ set\ register\ A}}
\DoxyCodeLine{00461\ \textcolor{comment}{**\ bit\ 4:\ operator\ is\ a\ test\ (next\ instruction\ must\ be\ a\ jump)}}
\DoxyCodeLine{00462\ \textcolor{comment}{**\ bit\ 5:\ instruction\ uses\ 'L-\/>top'\ set\ by\ previous\ instruction\ (when\ B\ ==\ 0)}}
\DoxyCodeLine{00463\ \textcolor{comment}{**\ bit\ 6:\ instruction\ sets\ 'L-\/>top'\ for\ next\ instruction\ (when\ C\ ==\ 0)}}
\DoxyCodeLine{00464\ \textcolor{comment}{**\ bit\ 7:\ instruction\ is\ an\ MM\ instruction\ (call\ a\ metamethod)}}
\DoxyCodeLine{00465\ \textcolor{comment}{*/}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ LUAI\_DDEC(\textcolor{keyword}{const}\ lu\_byte\ luaP\_opmodes[NUM\_OPCODES];)}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \#define\ getOpMode(m)\ \ \ \ (cast(\textcolor{keyword}{enum}\ OpMode,\ luaP\_opmodes[m]\ \&\ 7))}
\DoxyCodeLine{00470\ \#define\ testAMode(m)\ \ \ \ (luaP\_opmodes[m]\ \&\ (1\ <<\ 3))}
\DoxyCodeLine{00471\ \#define\ testTMode(m)\ \ \ \ (luaP\_opmodes[m]\ \&\ (1\ <<\ 4))}
\DoxyCodeLine{00472\ \#define\ testITMode(m)\ \ \ (luaP\_opmodes[m]\ \&\ (1\ <<\ 5))}
\DoxyCodeLine{00473\ \#define\ testOTMode(m)\ \ \ (luaP\_opmodes[m]\ \&\ (1\ <<\ 6))}
\DoxyCodeLine{00474\ \#define\ testMMMode(m)\ \ \ (luaP\_opmodes[m]\ \&\ (1\ <<\ 7))}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \textcolor{comment}{/*\ "{}out\ top"{}\ (set\ top\ for\ next\ instruction)\ */}}
\DoxyCodeLine{00477\ \#define\ isOT(i)\ \ \(\backslash\)}
\DoxyCodeLine{00478\ \ \ \ \ ((testOTMode(GET\_OPCODE(i))\ \&\&\ GETARG\_C(i)\ ==\ 0)\ ||\ \(\backslash\)}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ GET\_OPCODE(i)\ ==\ OP\_TAILCALL)}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \textcolor{comment}{/*\ "{}in\ top"{}\ (uses\ top\ from\ previous\ instruction)\ */}}
\DoxyCodeLine{00482\ \#define\ isIT(i)\ \ \ \ \ (testITMode(GET\_OPCODE(i))\ \&\&\ GETARG\_B(i)\ ==\ 0)}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \#define\ opmode(mm,ot,it,t,a,m)\ \ \(\backslash\)}
\DoxyCodeLine{00485\ \ \ \ \ (((mm)\ <<\ 7)\ |\ ((ot)\ <<\ 6)\ |\ ((it)\ <<\ 5)\ |\ ((t)\ <<\ 4)\ |\ ((a)\ <<\ 3)\ |\ (m))}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ LUAI\_FUNC\ \textcolor{keywordtype}{int}\ luaP\_isOT\ (Instruction\ i);}
\DoxyCodeLine{00488\ LUAI\_FUNC\ \textcolor{keywordtype}{int}\ luaP\_isIT\ (Instruction\ i);}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \textcolor{comment}{/*\ number\ of\ list\ items\ to\ accumulate\ before\ a\ SETLIST\ instruction\ */}}
\DoxyCodeLine{00491\ \textcolor{preprocessor}{\#define\ LFIELDS\_PER\_FLUSH\ \ \ 50}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
